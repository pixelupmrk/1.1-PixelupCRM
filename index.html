<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PixelUp SuperApp — CRM + Mentoria + ChatBot</title>
  <style>
    :root {
      --bg:#0b1118; --panel:#0f1724; --muted:#97b9d6; --text:#eaf6ff; --pri:#00bfff; --pri-2:#33ccff; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
      --border: rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#0a0f14,#0b1118 40%,#0a1016);color:var(--text)}
    a{color:var(--pri)}
    .container{max-width:1200px;margin:0 auto;padding:18px}
    .topbar{position:sticky;top:0;z-index:50;background:rgba(11,17,24,.82);backdrop-filter: blur(6px);border-bottom:1px solid var(--border)}
    .nav{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;padding:10px 18px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:28px;height:28px;border-radius:8px;background:radial-gradient(circle at 30% 30%,var(--pri-2),#001a2a);box-shadow:0 0 24px rgba(0,191,255,.35)}
    .brand h1{font-size:16px;margin:0;color:var(--pri)}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--border);background:#0f1724;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
    .btn:hover{border-color:rgba(255,255,255,.18)}
    .btn.pri{background:linear-gradient(90deg,var(--pri),var(--pri-2));color:#00131d;border:none}
    .btn.ghost{background:transparent}
    .badge{font-size:12px;padding:2px 6px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid var(--border)}
    .grid{display:grid;gap:16px}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    input,select,textarea{width:100%;background:#0c1320;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px}
    label{font-size:12px;color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--border);padding:10px;text-align:left}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .muted{color:var(--muted)}
    .kpi{display:grid;grid-template-columns:repeat(4,minmax(160px,1fr));gap:12px}
    .kpi .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px}
    .hidden{display:none}
    .chat{display:grid;grid-template-rows:1fr auto;gap:10px;height:60vh}
    .msglist{overflow:auto;border:1px solid var(--border);border-radius:14px;padding:10px;background:#0b121c}
    .msg{margin:8px 0;display:flex;gap:8px}
    .msg.b .bubble{background:#0f2030;border:1px solid var(--border)}
    .bubble{padding:10px 12px;border-radius:12px;background:#0d1a29;max-width:80%}
    .time{font-size:11px;color:var(--muted)}
    .footer{padding:12px;text-align:center;color:var(--muted)}
    .divider{height:1px;background:var(--border);margin:8px 0}
    .status{font-size:12px}
    .pill{padding:4px 8px;border:1px solid var(--border);border-radius:999px}
    .warn{color:var(--warn)}
    </style>
  <script>
    // === Erro Overlay (captura global) ===
    (function(){
      const overlay = document.createElement('div');
      overlay.id = 'px-error-overlay';
      overlay.style.cssText = 'position:fixed;inset:12px;z-index:99999;display:none;background:rgba(15,23,36,.96);color:#eaf6ff;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px;overflow:auto;font:12px/1.4 ui-monospace,Menlo,Consolas,monospace';
      overlay.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;gap:8px"><strong>PixelUp — Diagnóstico</strong><button id="px-error-close" style="background:#0c1320;border:1px solid rgba(255,255,255,.16);color:#eaf6ff;border-radius:8px;padding:6px 10px;cursor:pointer">Fechar</button></div><div id="px-error-log" style="white-space:pre-wrap;margin-top:8px"></div>';
      document.addEventListener('DOMContentLoaded',()=>{
        document.body.appendChild(overlay);
        document.getElementById('px-error-close').onclick = ()=> overlay.style.display='none';
      });
      function showErr(msg){
        const box = document.getElementById('px-error-log');
        if(!box) return;
        overlay.style.display='block';
        box.textContent = (box.textContent? box.textContent+'

' : '') + msg;
      }
      window.PX = window.PX || {};
      window.PX.diag = {
        log: (obj)=> showErr(typeof obj==='string'? obj : JSON.stringify(obj,null,2))
      };
      window.addEventListener('error', (e)=> showErr('Erro JS: '+ (e.message||'') +'
'+ (e.filename||'') +':'+ (e.lineno||'') ));
      window.addEventListener('unhandledrejection', (e)=> showErr('Promise rejeitada: '+ (e.reason && (e.reason.message||e.reason)) ));
    })();
  </script>
</head>
<body>
  <div class="topbar">
    <div class="nav">
      <div class="brand">
        <div class="logo"></div>
        <h1>PixelUp SuperApp</h1>
        <span class="badge">CRM + Mentoria + ChatBot</span>
      </div>
      <div class="tabs" id="tabs">
        <button class="btn ghost" data-route="#/dashboard">Dashboard</button>
        <button class="btn ghost" data-route="#/crm">CRM</button>
        <button class="btn ghost" data-route="#/mentoria">Mentoria</button>
        <button class="btn ghost" data-route="#/chat">ChatBot</button>
        <button class="btn ghost" data-route="#/config">Config</button>
        <span id="authInfo" class="badge">Desconectado</span>
      </div>
    </div>
  </div>

  <div class="container">
    <div id="authGate" class="panel">
      <h2>Entrar</h2>
      <p class="muted">Use seu e-mail e senha para acessar o SuperApp com seus dados do Firebase (Firestore).</p>
      <div class="grid" style="grid-template-columns:repeat(2,minmax(260px,1fr));">
        <div class="panel">
          <div class="grid">
            <div>
              <label for="email">E-mail</label>
              <input id="email" type="email" placeholder="voce@pixelup.com"/>
            </div>
            <div>
              <label for="pass">Senha</label>
              <input id="pass" type="password" placeholder="••••••••"/>
            </div>
            <div class="row">
              <button class="btn pri" id="btnLogin">Entrar</button>
              <button class="btn" id="btnSignup">Criar conta</button>
              <button class="btn" id="btnLogout" disabled>Sair</button>
            </div>
            <div id="authStatus" class="status muted"></div>
          </div>
        </div>
        <div class="panel">
          <h3>Estado</h3>
          <div id="stateBox" class="mono muted">Carregando…</div>
          <div class="divider"></div>
          <p class="muted">Dica: você pode testar localmente sem login definindo <span class="pill mono">window.PIXELUP_DEV_MODE = true</span> no console.</p>
        </div>
      </div>
    </div>

    <div id="app" class="grid hidden" style="grid-template-columns:1fr;">
      <div id="routeView"></div>
    </div>
  </div>

  <div class="footer">© <span id="year"></span> PixelUp. Feito com 💙 em Jaraguá do Sul.</div>

  <!-- Firebase SDKs -->
  <script type="module">
    // ===== Firebase Setup =====
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    // 👉 Substitua pelos dados do seu projeto (você já me passou estes):
    const firebaseConfig = {
      apiKey: "AIzaSyCjuQZP80sd4FtX83Zp5YgDmySpn7s6GZw",
      authDomain: "pixelup-crm.firebaseapp.com",
      projectId: "pixelup-crm",
      storageBucket: "pixelup-crm.firebasestorage.app",
      messagingSenderId: "286127901698",
      appId: "1:286127901698:web:f4dd954937fad94757ab1b",
      measurementId: "G-MBV63RYPN0"
    };

    const appFB = initializeApp(firebaseConfig);
    const auth = getAuth(appFB);
    const db = getFirestore(appFB);

    // ===== Simple State / Utils =====
    const $ = sel => document.querySelector(sel);
    const routeView = $("#routeView");
    const authGate = $("#authGate");
    const appMain = $("#app");
    const authInfo = $("#authInfo");
    const stateBox = $("#stateBox");
    const statusEl = $("#authStatus");
    const yearEl = $("#year"); yearEl.textContent = new Date().getFullYear();

    window.PIXELUP_DEV_MODE = false; // pode mudar para true para testar sem login

    // Persistência leve
    const cfg = {
      get API_URL(){ return localStorage.getItem("PIXELUP_API_URL") || ""; },
      set API_URL(v){ localStorage.setItem("PIXELUP_API_URL", v); },
      get API_TOKEN(){ return localStorage.getItem("PIXELUP_API_TOKEN") || ""; },
      set API_TOKEN(v){ localStorage.setItem("PIXELUP_API_TOKEN", v); },
    };

    // ===== Router =====
    const routes = {
      "#/dashboard": Dashboard,
      "#/crm": CRM,
      "#/mentoria": Mentoria,
      "#/chat": Chat,
      "#/config": Config
    };

    function router(){
      const hash = location.hash || "#/dashboard";
      const view = routes[hash] || NotFound;
      routeView.innerHTML = "";
      view();
      highlightTab(hash);
    }
    function highlightTab(hash){
      document.querySelectorAll('[data-route]').forEach(btn=>{
        btn.classList.toggle('pri', btn.dataset.route===hash);
      })
    }
    document.getElementById('tabs').addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-route]');
      if(btn){ location.hash = btn.dataset.route; }
    });
    window.addEventListener('hashchange', router);

    // ===== Auth UI =====
    $('#btnLogin').addEventListener('click', async ()=>{
      const email = $('#email').value.trim();
      const pass = $('#pass').value;
      statusEl.textContent = 'Entrando…';
      try{ await signInWithEmailAndPassword(auth, email, pass); }
      catch(err){ statusEl.textContent = 'Erro: '+ err.message; }
    });
    $('#btnSignup').addEventListener('click', async ()=>{
      const email = $('#email').value.trim();
      const pass = $('#pass').value;
      statusEl.textContent = 'Criando conta…';
      try{ await createUserWithEmailAndPassword(auth, email, pass); statusEl.textContent = 'Conta criada! Faça login.'; }
      catch(err){ statusEl.textContent = 'Erro: '+ err.message; }
    });
    $('#btnLogout').addEventListener('click', async ()=>{ await signOut(auth); });

    onAuthStateChanged(auth, (user)=>{
      const dev = window.PIXELUP_DEV_MODE;
      if(user || dev){
        authGate.classList.add('hidden');
        appMain.classList.remove('hidden');
        authInfo.textContent = user? `Logado: ${user.email}` : 'Dev Mode';
        router();
      } else {
        authGate.classList.remove('hidden');
        appMain.classList.add('hidden');
        authInfo.textContent = 'Desconectado';
      }
      stateBox.textContent = JSON.stringify({ uid: user?.uid || null, email: user?.email || null, API_URL: cfg.API_URL? 'definido' : 'vazio' }, null, 2);
      $('#btnLogout').disabled = !user && !dev;
    });

    // ===== Views =====
    async function runSelfTest(){
      const out = document.getElementById('selfTest');
      const checks = [];
      function ok(name, pass, extra=''){ checks.push({name, pass, extra}); }
      try{
        ok('DOM', !!document.body);
        ok('Firebase App', !!(auth && auth.app));
        ok('Auth Provider habilitado?', true, 'Verifique no console do Firebase > Authentication > Sign-in method: Email/Password ON');
        ok('Firestore acesso', true, 'Se travar em regras, ajuste as regras conforme abaixo.');
        // Firestore ping: leitura leve da collection contacts
        let readOk = false;
        try{ const s = await getDocs(collection(db,'contacts')); readOk = (s.size>=0); }catch(e){ PX.diag.log(e); }
        ok('Firestore leitura contacts', readOk);
        // API URL
        ok('ChatBot API_URL definida', !!cfg.API_URL, cfg.API_URL||'vazia');
      }catch(e){ PX.diag.log(e); }
      out.textContent = checks.map(c=> `${c.pass?'✅':'❌'} ${c.name}${c.extra? ' — '+c.extra:''}`).join('
');
    }
    function NotFound(){
      routeView.innerHTML = `<div class="panel"><h2>404</h2><p>Rota não encontrada.</p></div>`;
    }

    function Dashboard(){
      routeView.innerHTML = `
        <div class=\"grid\">
          <div class=\"kpi\">
            <div class=\"card\"><div class=\"muted\">Contatos</div><div id=\"kpiContacts\" style=\"font-size:24px\">—</div></div>
            <div class=\"card\"><div class=\"muted\">Módulos</div><div id=\"kpiModules\" style=\"font-size:24px\">—</div></div>
            <div class=\"card\"><div class=\"muted\">Mensagens ChatBot</div><div id=\"kpiMsgs\" style=\"font-size:24px\">—</div></div>
            <div class=\"card\"><div class=\"muted\">Status</div><div id=\"kpiStatus\" style=\"font-size:14px\" class=\"mono\">API: ${cfg.API_URL? 'OK' : 'Configurar'}</div></div>
          </div>
          <div class=\"grid\" style=\"grid-template-columns:repeat(2,minmax(280px,1fr));\">
            <div class=\"panel\">
              <h3>Atalhos</h3>
              <div class=\"row\">
                <button class=\"btn pri\" onclick=\"location.hash='#/crm'\">Abrir CRM</button>
                <button class=\"btn\" onclick=\"location.hash='#/mentoria'\">Abrir Mentoria</button>
                <button class=\"btn\" onclick=\"location.hash='#/chat'\">Abrir ChatBot</button>
              </div>
            </div>
            <div class=\"panel\">
              <h3>Resumo</h3>
              <div id=\"dashLog\" class=\"mono muted\">Carregando…</div>
            </div>
          </div>
          <div class=\"panel\">
            <div class=\"row\" style=\"justify-content:space-between;align-items:center\">
              <h3>Auto‑diagnóstico</h3>
              <button class=\"btn\" id=\"btnSelfTest\">Rodar teste</button>
            </div>
            <div id=\"selfTest\" class=\"mono muted\">Pronto para testar.</div>
          </div>
        </div>`;
      // Load KPIs
      loadKpi();
      // Bind Self‑Test
      setTimeout(()=>{ const b=document.getElementById('btnSelfTest'); if(b) b.onclick = runSelfTest; }, 0);
    }

    async function loadKpi(){
      try{
        const snapContacts = await getDocs(collection(db, 'contacts'));
        $('#kpiContacts').textContent = snapContacts.size;
      }catch{ $('#kpiContacts').textContent = '—'; }
      try{
        const snapModules = await getDocs(collection(db, 'modules'));
        $('#kpiModules').textContent = snapModules.size || (SampleModules.length + ' (exemplo)');
      }catch{ $('#kpiModules').textContent = SampleModules.length + ' (exemplo)'; }
      $('#kpiMsgs').textContent = Session.msgCount || 0;
      $('#dashLog').textContent = JSON.stringify({
        user: auth.currentUser?.email || (window.PIXELUP_DEV_MODE?'dev':'none'),
        apiConfigured: !!cfg.API_URL,
        time: new Date().toISOString()
      }, null, 2);
    }

    function CRM(){
      routeView.innerHTML = `
        <div class="grid" style="grid-template-columns: 1.1fr .9fr;">
          <div class="panel">
            <h2>Contatos</h2>
            <table>
              <thead><tr><th>Nome</th><th>Whats</th><th>Status</th><th>Criado</th></tr></thead>
              <tbody id="tbContacts"><tr><td colspan="4" class="muted">Carregando…</td></tr></tbody>
            </table>
          </div>
          <div class="panel">
            <h3>Novo contato</h3>
            <div class="grid">
              <div><label>Nome</label><input id="c_name" placeholder="Cliente"/></div>
              <div><label>WhatsApp</label><input id="c_whats" placeholder="(47) 99999-0000"/></div>
              <div><label>Status</label><select id="c_status"><option>Novo</option><option>Em atendimento</option><option>Ganhou</option><option>Perdeu</option></select></div>
              <button class="btn pri" id="btnSaveC">Salvar</button>
              <div id="saveMsg" class="status muted"></div>
            </div>
          </div>
        </div>`;
      loadContacts();
      $('#btnSaveC').onclick = saveContact;
    }

    async function loadContacts(){
      try{
        const q = query(collection(db,'contacts'), orderBy('created','desc'));
        const snap = await getDocs(q);
        const tbody = $('#tbContacts');
        tbody.innerHTML='';
        if(snap.empty){ tbody.innerHTML = `<tr><td colspan="4" class="muted">Sem contatos ainda.</td></tr>`; return; }
        snap.forEach(docu=>{
          const c = docu.data();
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${c.name||''}</td><td>${c.whats||''}</td><td>${c.status||''}</td><td>${c.created?.toDate? c.created.toDate().toLocaleString(): ''}</td>`;
          $('#tbContacts').appendChild(tr);
        })
      }catch(err){ $('#tbContacts').innerHTML = `<tr><td colspan="4" class="warn">Erro: ${err.message}</td></tr>`; }
    }

    async function saveContact(){
      const name = $('#c_name').value.trim();
      const whats = $('#c_whats').value.trim();
      const status = $('#c_status').value;
      if(!name){ $('#saveMsg').textContent='Informe o nome.'; return; }
      try{
        await addDoc(collection(db,'contacts'),{ name, whats, status, created: serverTimestamp(), uid: auth.currentUser?.uid || 'dev' });
        $('#saveMsg').textContent='Contato salvo!';
        $('#c_name').value=''; $('#c_whats').value='';
        loadContacts();
        loadKpi();
      }catch(err){ $('#saveMsg').textContent='Erro: '+err.message; }
    }

    function Mentoria(){
      routeView.innerHTML = `
        <div class="grid" style="grid-template-columns: .9fr 1.1fr;">
          <div class="panel">
            <h2>Módulos</h2>
            <div id="modList" class="grid"></div>
          </div>
          <div class="panel">
            <h3 id="lessonTitle">Selecione um módulo</h3>
            <div id="lessonBody" class="muted"></div>
            <div class="divider"></div>
            <div class="row">
              <input id="modSearch" placeholder="Buscar no conteúdo…"/>
              <button class="btn" id="btnSearch">Buscar</button>
            </div>
            <div id="searchRes" class="muted"></div>
          </div>
        </div>`;
      renderModules();
    }

    const SampleModules = [
      { id:'m1', title:'Módulo 1 — Persona', content:`Definição de persona, dores, desejos e objeções.\n\nChecklist:\n- Nicho e subnicho\n- Mapa de dores\n- Benefícios chave\n- Linguagem e vocabulário`, order:1 },
      { id:'m2', title:'Módulo 2 — Algoritmo do Meta', content:`Como o algoritmo decide entrega e custo.\n\nPilares:\n- Criativo\n- Segmentação\n- Conversões (pixel/SDK)`, order:2 },
      { id:'m3', title:'Módulo 3 — Cronograma de Postagens', content:`Calendário editorial e formatos: feed, reels, stories.`, order:3 }
    ];

    async function fetchModules(){
      try{
        const q = query(collection(db,'modules'), orderBy('order','asc'));
        const snap = await getDocs(q);
        if(snap.empty) return SampleModules;
        const list = [];
        snap.forEach(d=>{ list.push({ id:d.id, ...d.data() }) });
        return list;
      }catch{ return SampleModules; }
    }

    async function renderModules(){
      const list = await fetchModules();
      const box = $('#modList');
      box.innerHTML = '';
      list.forEach(m=>{
        const card = document.createElement('div');
        card.className='panel';
        card.innerHTML = `<div class="row" style="justify-content:space-between"><div><strong>${m.title}</strong></div><button class="btn" data-mod="${m.id}">Abrir</button></div>`;
        box.appendChild(card);
      });
      box.addEventListener('click', (e)=>{
        const btn = e.target.closest('[data-mod]');
        if(btn){ const id = btn.dataset.mod; const mod = list.find(x=>x.id===id || x.id===id.replace('m','')); openLesson(mod || list[0]); }
      }, { once:true });
      // Busca
      $('#btnSearch').onclick = ()=>{
        const q = $('#modSearch').value.toLowerCase();
        const found = list.flatMap(m=> (m.content||'').toLowerCase().includes(q)? [m.title]: []);
        $('#searchRes').textContent = found.length? `Encontrado em: ${found.join(', ')}` : 'Nada encontrado.';
      }
    }

    function mdToHtml(md=''){
      return md
        .replace(/\n\n/g,'</p><p>')
        .replace(/\n/g,'<br/>')
        .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
        .replace(/\*(.*?)\*/g,'<em>$1</em>');
    }
    function openLesson(m){
      if(!m) return;
      $('#lessonTitle').textContent = m.title;
      $('#lessonBody').innerHTML = '<p>'+ mdToHtml(m.content||'') +'</p>';
    }

    const Session = { msgCount: 0 };

    function Chat(){
      routeView.innerHTML = `
        <div class="panel chat">
          <div class="msglist" id="msgs"></div>
          <div class="row">
            <input id="chatInput" placeholder="Digite sua mensagem…"/>
            <button class="btn pri" id="btnSend">Enviar</button>
            <span class="muted mono">API: ${cfg.API_URL? cfg.API_URL : 'não configurada'}</span>
          </div>
        </div>`;
      const input = $('#chatInput');
      $('#btnSend').onclick = ()=> sendMsg(input.value.trim());
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ sendMsg(input.value.trim()); }});
    }

    function addMsg(role, text){
      const wrap = $('#msgs');
      const row = document.createElement('div');
      row.className = 'msg '+ (role==='user'? 'b' : '');
      row.innerHTML = `<div class="bubble"><div>${text}</div><div class="time">${new Date().toLocaleTimeString()}</div></div>`;
      wrap.appendChild(row); wrap.scrollTop = wrap.scrollHeight;
    }

    async function sendMsg(text){
      if(!text) return;
      addMsg('user', text);
      $('#chatInput').value='';
      Session.msgCount++; loadKpi();
      if(!cfg.API_URL){ addMsg('bot', '⚠️ Configure a API em Config > ChatBot.'); return; }
      try{
        const r = await fetch(cfg.API_URL,{
          method:'POST',
          headers:{ 'Content-Type':'application/json', ...(cfg.API_TOKEN? { 'Authorization': 'Bearer '+cfg.API_TOKEN } : {}) },
          body: JSON.stringify({ message: text, userId: auth.currentUser?.uid || 'dev' })
        });
        if(!r.ok){ throw new Error('HTTP '+r.status); }
        const data = await r.json();
        addMsg('bot', data.reply || JSON.stringify(data));
      }catch(err){ addMsg('bot', 'Erro ao chamar API: '+ err.message); }
    }

    function Config(){
      routeView.innerHTML = `
        <div class="grid" style="grid-template-columns:1fr 1fr;">
          <div class="panel">
            <h3>ChatBot — Configuração</h3>
            <div class="grid">
              <div><label>API_URL</label><input id="cfg_url" placeholder="https://seu-servidor/api/chat" value="${cfg.API_URL}"></div>
              <div><label>API_TOKEN (opcional)</label><input id="cfg_tok" placeholder="seu-token" value="${cfg.API_TOKEN}"></div>
              <div class="row"><button class="btn pri" id="btnSaveCfg">Salvar</button><span id="cfgMsg" class="status muted"></span></div>
              <p class="muted">A API deve responder JSON no formato <span class="mono">{ reply: "texto" }</span>.</p>
            </div>
          </div>
          <div class="panel">
            <h3>Mentoria — Admin rápido</h3>
            <div class="grid">
              <div><label>Título</label><input id="a_title" placeholder="Módulo X — Título"></div>
              <div><label>Ordem</label><input id="a_order" type="number" value="1"></div>
              <div><label>Conteúdo (Markdown simples)</label><textarea id="a_content" rows="6" placeholder="Seu conteúdo…"></textarea></div>
              <button class="btn" id="btnAddMod">Adicionar/Atualizar</button>
              <div id="adminMsg" class="status muted"></div>
            </div>
          </div>
        </div>`;
      $('#btnSaveCfg').onclick = ()=>{
        cfg.API_URL = $('#cfg_url').value.trim();
        cfg.API_TOKEN = $('#cfg_tok').value.trim();
        $('#cfgMsg').textContent = 'Salvo.';
      };
      $('#btnAddMod').onclick = saveModule;
    }

    async function saveModule(){
      const title = $('#a_title').value.trim();
      const content = $('#a_content').value.trim();
      const order = parseInt($('#a_order').value||'1',10) || 1;
      if(!title || !content){ $('#adminMsg').textContent = 'Preencha título e conteúdo.'; return; }
      try{
        const id = title.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
        await setDoc(doc(db,'modules', id), { title, content, order });
        $('#adminMsg').textContent = 'Módulo salvo!';
      }catch(err){ $('#adminMsg').textContent = 'Erro: '+ err.message; }
    }

    // Inicializa rota na primeira carga ao logar
    // (o router é chamado no onAuthStateChanged)

  </script>
</body>
</html>
